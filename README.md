# QSC [2023-spring-round-two](https://github.com/QSCTech/2023-spring-round-two) Minecraft Sever

项目大纲

### 初始化并登录

- 服务端读取 玩家的 `name` 和 `passwd` 的 md5 和 地图，开始监听。

- 客户端发送  md5 加密后的 `name | passwd` 

- 服务器接受 用 加密后的 用户名 和 密码：返回 `Accept` 或 `Wrong` 

- 客户端根据返回值决定是否退出循环。

### 游戏过程

- 数据包类
  
  `操作序号id | 移动指令WASD O 或 修改指令FC | 坐标(x,y) | 地图{{...}...{...}}`  
  
  - 修改指令 `F` 表示无论操作序号是否符合都修改。
  
  - `U`  则表示操作序号相同时才修改。

- 客户端
  
  - 线程一：
    
    - `Lock`
    
    - 接受玩家 WASD 指令。
    
    - 计算地图发送
    
    - 操作序号+移动指令+（该序号移动完）移动后的坐标+移动后的地图到 服务端
      
       `112 W (1,2) {{...}...{...}}`
    
    - 重新打印页面
    
    - `Unlock` 
  
  - 线程二：接受 修正 数据包
    
    - 收到数据包
    
    - `Lock` 
    
    - 根据 操作序号 和 操作命令 修改
    
    - `Unlock`   
  
  - 线程三：每隔 0.05 秒发送一包数据（本来打算在服务器上干这事）
    
    - `Lock` 
    
    - `122 D (x,y) {{...}...}` 
    
    - `Unlock` 

- 服务端
  
  - 线程一：生产者
    
    - 接受 客户端 线程一 发送的数据包。
    
    - `Lock` 
    
    - 放入队列
    
    - `Unlock` 
  
  - 线程二： 消费者
    
    - `Lock` 
    
    - 取出队首
    
    - 根据服务器的地图验算
      
      - 先验算序号，若不符合直接修正，否则对比或验算。
      
      - 若相符合，结束。
      
      - 若不符合，发送一份修正数据包到 客户端（由客户端线程 2 接收），强制修改。
        
        `122 F (x,y) {{...}...{...}}` 操作序号+Force+移动后的坐标+移动后的地图。
    
    - `Unlock`  

### 退出
